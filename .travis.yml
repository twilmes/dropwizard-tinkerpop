language: java

jdk:
- oraclejdk8

branches:
  only:
  - master
  #- "/^v\\d+\\.\\d+\\.\\d+$/"

cache:
  directories:
  - $HOME/.m2/repository

sudo: required

services:
  - docker

before_install:
- docker pull jbmusso/gremlin-server
- docker run -d --name gremlin-server -p 8182:8182 jbmusso/gremlin-server:latest
- docker run -d --name gremlin-server-ssl -p 8183:8182 jbmusso/gremlin-server:latest conf/gremlin-server-secure.yaml
- while ! echo exit | nc localhost 8182; do sleep 5; done
- while ! echo exit | nc localhost 8183; do sleep 5; done

# skip the default install step
install: true

#before_script:
#  - if [ ! -z "${GPG_SECRET_KEYS}" ]; then echo ${GPG_SECRET_KEYS} | base64 --decode | $GPG_EXECUTABLE --import; fi
#  - if [ ! -z "${GPG_OWNERTRUST}" ]; then echo ${GPG_OWNERTRUST} | base64 --decode | $GPG_EXECUTABLE --import-ownertrust; fi

script:
- cp .travis.settings.xml $HOME/.m2/settings.xml && mvn clean deploy
